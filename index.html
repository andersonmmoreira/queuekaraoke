<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karaoke - Master Pizza</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <header class="flex justify-center items-center h-32 bg-black">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRkkQ3oke6l4C7cvDUqYAkJkl0VZqGH6fRDAg&s" width="100px" alt="">    
    </header>
    <h2 class="text-center text-3xl mt-3">Karaôke</h2>
    <main class="w-[100%] p-5 mx-auto">
        <div class="w-full max-w-md mx-auto bg-white shadow-lg rounded-lg p-6">
            <h1 class="text-2xl font-bold mb-4 text-gray-800 text-center">Playlist</h1>
            
            <div class="mb-4 ">
                <input 
                    id="person-name" 
                    type="text" 
                    placeholder="Pessoa" 
                    class="w-full px-4 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2">
                <input 
                    id="music-name" 
                    type="text" 
                    placeholder="Música" 
                    class="w-full px-4 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2">
                <input 
                    id="table-number" 
                    type="text" 
                    placeholder="Mesa" 
                    class="w-full px-4 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2">
                
                <button 
                    onclick="saveMusic()" 
                    class="mt-2 w-full bg-blue-500 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    Salvar
                </button>
            </div>
            
            <!-- Lista de tarefas -->
            <ul id="task-list" class="list-disc pl-5">
                <!-- Tarefas serão adicionadas aqui -->
            </ul>

            <table class="w-full text-sm text-left rtl:text-right text-gray-900 dark:text-gray-900">
                <thead class="w-full text-sm text-left rtl:text-right text-gray-900 dark:text-gray-400">
                    <tr>
                        <th>Código</th>
                        <th>Nome</th>
                        <th>Música</th>
                        <th>Mesa</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="music-table">
                    
                </tbody>
            </table>
        </div>
    </main>
    <footer>

    </footer>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>

        const baseURL = 'https://queuekaraoke.vercel.app/';
        let lista = []

        function getList() {
            document.getElementById('music-table').innerHTML = ''
            lista.map((music, indice) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${indice}</td>
                    <td>${music.name}</td>
                    <td>${music.music}</td>
                    <td>${music.table}</td>
                    <td>
                        <button onclick="deleteMusic(${music.id})">Deletar</button>
                    </td>
                `;
                document.getElementById('music-table').appendChild(row);
            });
        }

        function getListMusic() {
            
            axios.get(baseURL+'musicas')
            .then(function(response) {
                lista = response.data;
                document.getElementById('music-table').innerHTML = ''
                response.data.map((music, indice) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${indice}</td>
                        <td class="text-1xl">${music.name}</td>
                        <td>${music.music}</td>
                        <td>${music.table}</td>
                        <td>
                            <button class="w-full bg-red-500 text-white px-4 py-2 rounded-lg shadow hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500" onclick="deleteMusic(${indice})">Deletar</button>
                        </td>
                    `;
                    document.getElementById('music-table').appendChild(row);
                });
            })
            .catch(function(error) {
                alert(error.message)
            });;       
        }

        
        setInterval(function() {
            getListMusic();
        }, 2000)
        

        function saveMusic() {
            const name = document.getElementById("person-name").value
            const music = document.getElementById("music-name").value
            const table = document.getElementById("table-number").value


            if(name === '' || music === '' || table === '') {
                // alert('Todos os campos são obrigatórios!')
                Swal.fire({
                    icon: "error",
                    title: "Oops...",
                    text: "Todos os campos são obrigatórios!"
                });
                return;
            }
            const task = {
                name,
                music,
                table
            };

            axios.post(baseURL+'musicas', task)
            .then(function(response) {
                
                lista.push(task)
                getList();
                document.getElementById("person-name").value = ''
                document.getElementById("music-name").value = ''
                document.getElementById("table-number").value = ''
            })
            .catch(function(error) {
                alert(error.message)
            });               
        }

        function deleteMusic(id) {
           
  

            Swal.fire({
                title: "Deseja deletar a Musica?",
                icon: "info",
                showDenyButton: true,
                showCancelButton: true,
                confirmButtonText: "Sim",
                denyButtonText: `Não`
                }).then((result) => {
                /* Read more about isConfirmed, isDenied below */
                if (result.isConfirmed) {
                    axios.delete(baseURL+'musicas/'+id)
                    .then(function(response) {
                        
                        lista.splice(indice, 1)
                        getList();
                    })
                    .catch(function(error) {
                        alert(error.message)
                    });
                } else if (result.isDenied) {
                    
                }
                });

           
            
                        
        }
    </script>
</body>
</html>
